{"version":3,"sources":["webpack:///src/js/components/canvas.vue","webpack:///./src/js/components/canvas.vue?e639","webpack:///./src/js/components/canvas.vue?c712","webpack:///./src/js/components/canvas.vue?557c","webpack:///./src/js/components/canvas.vue","webpack:///./src/js/components/canvas.vue?3e3e","webpack:///./src/js/components/canvas.vue?b3e4"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA;;;;0KAIA;AAFA;AAGA,wCAEA;;YAEA;kDACA;AACA;aACA;mDACA;AAEA;;2BACA;;iEAEA;kEACA;2BACA;4BACA;0BAEA;AANA;;oBASA;AAFA;mBAIA;;iBACA;AAEA;AAvBA;YAwBA;qBAEA;;;wCAGA;AAFA;;yCAMA;AAHA;;;yBAKA;0BACA;sBACA;iBACA;8BAEA;AANA;+BASA;;AACA;AACA;AAGA;;;wCACA;AACA;qEACA;mFACA;AACA;wCACA;AACA;mFACA;AAEA;;+CACA;AACA;AACA;wCACA;AACA;AACA;AACA;AAEA;;mCACA;AACA;oBACA;yBACA;;;UAEA;;kBACA;yCACA;iBACA;sDACA;6CACA;iBACA;wDACA;2CACA;iBACA;gEACA;2CACA;iBACA;2DACA;2CACA;iBACA;wDACA;eACA;iBACA;uDACA;AAEA;;sEACA;gCACA;kCACA;AACA;AACA;AACA;sCAEA;;SAEA;;AACA;0EACA;AACA;AACA;AACA;AACA;AACA;AAEA;;yDAEA;;mDACA;sEACA;iCACA;AACA;mDACA;oEACA;gCACA;AACA;oDACA;uBACA;kBACA;yCACA;mEACA;yCACA;AACA;AACA;sDACA;uBACA;kBACA;mEACA;yCACA;AACA;AACA;sDACA;uBACA;kBACA;qEACA;yCACA;AACA;uDACA;uBACA;kBACA;qEACA;yCACA;AAEA;;kCACA;+BACA;AACA;SACA;;iBAEA;kBAEA;AAHA;AAIA;AAvKA,E;;;;;;;;;;;ACbA;AACA;;;AAGA;AACA,4CAA6C,YAAY,uBAAuB,qBAAqB,GAAG,yCAAyC,yBAAyB,4BAA4B,GAAG,wCAAwC,qBAAqB,sBAAsB,kBAAkB,uBAAuB,YAAY,WAAW,gBAAgB,iBAAiB,gBAAgB,gCAAgC,6BAA6B,GAAG,4DAA4D,+BAA+B,oBAAoB,GAAG,oEAAoE,uBAAuB,qBAAqB,yBAAyB,mDAAmD,GAAG,qBAAqB,yBAAyB,uBAAuB,gBAAgB,2BAA2B,YAAY,WAAW,iBAAiB,gBAAgB,GAAG,mCAAmC,qBAAqB,4BAA4B,yBAAyB,gDAAgD,kBAAkB,GAAG;;AAE3lC;;;;;;;;;;;;;;;ACPA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,gCAAgC;AACrC;AACA,0BAA0B,SAAS,gCAAgC,EAAE;AACrE;AACA,0BAA0B,SAAS,kCAAkC,EAAE;AACvE;AACA,oBAAoB,iDAAiD;AACrE;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C;AACA,Y;;;;;;;;;;;;;;;;;;ACVkC;AAClC;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,uBAiBA;AACA;AACA,gF;;;;;;;;;;;;;;;;ACvC2K,2OAAoB,C;;;;;;;;;;;;;;;;ACAyJ,2XAAoB,C","file":"16.build.js","sourcesContent":["<template>\r\n  <div class=\"canvas-wrapper\">\r\n\r\n    <CanvasCoords :top=\"scrollTop\" axis=\"x\"></CanvasCoords>\r\n    <CanvasCoords :left=\"scrollLeft\" axis=\"y\"></CanvasCoords>\r\n\r\n    <canvas class=\"no-invert canvas\" ref=\"canvas\"></canvas>\r\n    \r\n  </div>\t\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  components: {\r\n    CanvasCoords: () => import(\"./canvas-coords.vue\")\r\n  },\r\n  computed: {\r\n    ...Vuex.mapState([\"canvas\"])\r\n  },\r\n  methods: {\r\n    width() {\r\n      if (this.$el) return this.$el.clientWidth - 20;\r\n    },\r\n    height() {\r\n      if (this.$el) return this.$el.clientHeight - 20;\r\n    },\r\n    \r\n    initCanvasBackground() {\r\n      let rect = new fabric.Rect({\r\n        left: this.canvas.wrapperWidth / 2 - this.canvas.width / 2,\r\n        top: this.canvas.wrapperHeight / 2 - this.canvas.height / 2,\r\n        width: this.canvas.width,\r\n        height: this.canvas.height,\r\n        fill: this.canvas.backgroundColor  \r\n      });\r\n      let group = this.canvas.background = new fabric.Group([rect], {\r\n        selectable: false\r\n      });\r\n      group.type = 'background'\r\n\r\n      this.c.add(group)\r\n    }\r\n  },\r\n  mounted() {\r\n    let counter = 1; //счетчик слоев\r\n\r\n    Object.defineProperty(this.canvas, 'wrapperWidth', {\r\n      get: () => this.$el.clientWidth - 20     \r\n    })\r\n     Object.defineProperty(this.canvas, 'wrapperHeight', {\r\n      get: () => this.$el.clientHeight - 20  \r\n    })\r\n\r\n    this.canvas.c = this.c = new fabric.Canvas(this.$refs.canvas, {\r\n      width: this.canvas.wrapperWidth,\r\n      height: this.canvas.wrapperHeight,\r\n      skipTargetFind: true,\r\n      selection: false,\r\n      preserveObjectStacking: true,\r\n    });\r\n    this.canvas.wrapper = this.$el\r\n  \r\n\r\n    // this.c.on('object:modified', e => {\r\n    // \tconsole.log(e);\r\n    // })\r\n    \r\n\r\n    this.c.on(\"selection:created\", e => {\r\n      //console.log(e, 'selection created');\r\n      console.log(this.canvas.layers.find(layer => layer.group === e.target));\r\n      this.canvas.activeLayer = this.canvas.layers.find(layer => layer.group === e.target);\r\n    });\r\n    this.c.on(\"selection:updated\", e => {\r\n      //console.log(e, 'selection updated');\r\n      this.canvas.activeLayer = this.canvas.layers.find(layer => layer.group === e.target);\r\n    });\r\n\r\n    this.c.on(\"before:selection:cleared\", e => {\r\n      //console.log(e, 'before selection cleared');\r\n    });\r\n    this.c.on(\"selection:cleared\", e => {\r\n      //console.log(e, 'selection cleared');\r\n      //console.log('cleared');\r\n      //this.canvas.activeLayer = null;\r\n    });\r\n\r\n    this.c.on(\"object:added\", e => {\r\n      //prettier-ignore\r\n      let group = e.target,\r\n\t\t\t\t\tobject = group.object,\r\n\t\t\t\t\ttitle, layer, type;\r\n\r\n      if (object) {\r\n        if (group.type === \"background\") {\r\n          type = \"background\";\r\n          title = `Фон ${this.canvas.layers.length + 1}`;\r\n        } else if (object.type === \"i-text\") {\r\n          type = \"text\";\r\n          title = `Текст ${this.canvas.layers.length + 1}`;\r\n        } else if (object.type === \"rect\") {\r\n          type = \"square\";\r\n          title = `Прямоугольник ${this.canvas.layers.length + 1}`;\r\n        } else if (object.type === \"path\") {\r\n          type = \"pencil\";\r\n          title = `Карандаш ${this.canvas.layers.length + 1}`;\r\n        } else if (object.type === \"line\") {\r\n          type = \"line\";\r\n          title = `Линия ${this.canvas.layers.length + 1}`;\r\n        }  else {\r\n          type = \"nothing\";\r\n          title = `Слой ${this.canvas.layers.length + 1}`;\r\n        }\r\n\r\n        layer = { object, group, type, title, id: counter++, visible: true };\r\n        this.canvas.layers.push(layer);\r\n        this.canvas.activeLayer = layer;\r\n        return;\r\n      }\r\n    });\r\n    this.c.on(\"object:removed\", e => {});\r\n\r\n    this.initCanvasBackground()\r\n\r\n    //кастомные полосы прокрутки\r\n    $(this.canvas.c.wrapperEl).css({position:'absolute', left: 20, top: 20 });\r\n    // $(this.$el).niceScroll('.scroll', {\r\n    //   cursorcolor: \"#535353\",\r\n    //   cursorborder: \"1px solid #535353\",\r\n    //   autohidemode: \"leave\",\r\n    //   enablecrollonselectionL: false\r\n    // });\r\n\r\n    this.ps = this.canvas.ps = new PerfectScrollbar(this.$el);\r\n\r\n    this.$el.addEventListener('ps-scroll-x' , () => {\r\n      this.canvas.c.wrapperEl.style.left = this.$el.scrollLeft + 20 + 'px'\r\n      this.scrollLeft = this.$el.scrollLeft   \r\n    })\r\n    this.$el.addEventListener('ps-scroll-y' , () => {\r\n      this.canvas.c.wrapperEl.style.top = this.$el.scrollTop + 20 + 'px'\r\n      this.scrollTop = this.$el.scrollTop    \r\n    })\r\n    this.$el.addEventListener('ps-scroll-up' ,  () => {\r\n      let vpt = this.c.viewportTransform;\r\n      console.log(vpt);\r\n      console.log(this.canvas.background.top);\r\n      vpt[5] = -this.$el.scrollTop + -this.canvas.background.top * 2;\r\n      this.canvas.c.setViewportTransform(vpt)\r\n      //this.c.setViewportTransform(vpt)\r\n    })\r\n    this.$el.addEventListener('ps-scroll-down' ,  () => {\r\n      let vpt = this.c.viewportTransform;\r\n      console.log(vpt);\r\n      vpt[5] = -this.$el.scrollTop + -this.canvas.background.top * 2;\r\n      this.canvas.c.setViewportTransform(vpt)\r\n      //this.c.setViewportTransform(vpt)\r\n    })\r\n     this.$el.addEventListener('ps-scroll-left' ,  () => {\r\n      let vpt = this.c.viewportTransform;\r\n      console.log(vpt);\r\n      vpt[4] = -this.$el.scrollLeft + -this.canvas.background.left * 2;\r\n      this.canvas.c.setViewportTransform(vpt)\r\n    })\r\n    this.$el.addEventListener('ps-scroll-right' ,  () => {\r\n      let vpt = this.c.viewportTransform;\r\n      console.log(vpt);\r\n      vpt[4] = -this.$el.scrollLeft + -this.canvas.background.left * 2;\r\n      this.canvas.c.setViewportTransform(vpt)\r\n    })\r\n\r\n    bus.$emit(\"toolEventActive\"); // обработчик в common-tools\r\n    bus.$emit('createCoords') // обработчик в canvas-coords\r\n  },\r\n  data() {\r\n    return {\r\n      scrollTop: 0,\r\n      scrollLeft: 0\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"sass\">\r\n@import '../../sass/_help'\r\n\r\n.canvas-wrapper\r\n  flex: 1\r\n  position: relative\r\n  overflow: hidden\r\n  .canvas-wrapper-inner\r\n    position: absolute\r\n    display: inline-block\r\n\r\n// .lower-canvas\r\n//   background-image: url(data:image/gif;base64,R0lGODlhCgAKAIAAAOLi4v///yH5BAAHAP8ALAAAAAAKAAoAAAIRhB2ZhxoM3GMSykqd1VltzxQAOw==)\r\n\r\n\r\n.coords-x-wrapper\r\n\tfont-size: .7rem\r\n\tline-height: 30px\r\n\tdisplay: flex\r\n\tposition: absolute\r\n\tleft: 0\r\n\ttop: 0\r\n\tz-index: 20\r\n\theight: 20px\r\n\twidth: 100%\r\n\tbackground: var(--bg-color)\r\n\tcolor: var(--text-color)\r\n\t.coords-x\r\n\t\twidth: calc(100% - 20px)\r\n\t\tdisplay: flex\r\n\t\tdiv\r\n\t\t\tflex-shrink: 0\r\n\t\t\theight: 20px\r\n\t\t\ttext-indent: 2px\r\n\t\t\t+bl()\r\n.coords-y-wrapper\r\n\t@extend .coords-x-wrapper\r\n\tline-height: inherit\r\n\tposition: absolute\r\n\tz-index: 10 \r\n\tflex-direction: column\r\n\tleft: 0\r\n\ttop: 0\r\n\theight: 100%\r\n\twidth: 20px\t\r\n\t.coords-y\r\n\t\tdiv\r\n\t\t\tflex-shrink: 0\r\n\t\t\twhite-space: pre-wrap\r\n\t\t\ttext-align: center\r\n\t\t\t+bt()\r\n\t\t\twidth: 20px\r\n\r\n</style>\r\n","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"\\n.canvas-wrapper {\\n  flex: 1;\\n  position: relative;\\n  overflow: hidden;\\n}\\n.canvas-wrapper .canvas-wrapper-inner {\\n    position: absolute;\\n    display: inline-block;\\n}\\n.coords-x-wrapper, .coords-y-wrapper {\\n  font-size: .7rem;\\n  line-height: 30px;\\n  display: flex;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 20;\\n  height: 20px;\\n  width: 100%;\\n  background: var(--bg-color);\\n  color: var(--text-color);\\n}\\n.coords-x-wrapper .coords-x, .coords-y-wrapper .coords-x {\\n    width: calc(100% - 20px);\\n    display: flex;\\n}\\n.coords-x-wrapper .coords-x div, .coords-y-wrapper .coords-x div {\\n      flex-shrink: 0;\\n      height: 20px;\\n      text-indent: 2px;\\n      border-left: 1px solid var(--border-color);\\n}\\n.coords-y-wrapper {\\n  line-height: inherit;\\n  position: absolute;\\n  z-index: 10;\\n  flex-direction: column;\\n  left: 0;\\n  top: 0;\\n  height: 100%;\\n  width: 20px;\\n}\\n.coords-y-wrapper .coords-y div {\\n    flex-shrink: 0;\\n    white-space: pre-wrap;\\n    text-align: center;\\n    border-top: 1px solid var(--border-color);\\n    width: 20px;\\n}\\n\", \"\"]);\n\n// exports\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    { staticClass: \"canvas-wrapper\" },\n    [\n      _c(\"CanvasCoords\", { attrs: { top: _vm.scrollTop, axis: \"x\" } }),\n      _vm._v(\" \"),\n      _c(\"CanvasCoords\", { attrs: { left: _vm.scrollLeft, axis: \"y\" } }),\n      _vm._v(\" \"),\n      _c(\"canvas\", { ref: \"canvas\", staticClass: \"no-invert canvas\" })\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"67c9576b\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\", function() {\n     var newContent = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\");\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","import { render, staticRenderFns } from \"./canvas.vue?vue&type=template&id=14471411\"\nimport script from \"./canvas.vue?vue&type=script&lang=js\"\nexport * from \"./canvas.vue?vue&type=script&lang=js\"\nimport style0 from \"./canvas.vue?vue&type=style&index=0&lang=sass\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\project\\\\paint_in_web\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('14471411', component.options)\n    } else {\n      api.reload('14471411', component.options)\n    }\n    module.hot.accept(\"./canvas.vue?vue&type=template&id=14471411\", function () {\n      api.rerender('14471411', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src\\\\js\\\\components\\\\canvas.vue\"\nexport default component.exports","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=script&lang=js\"","import mod from \"-!../../../node_modules/vue-style-loader/index.js!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\"; export default mod; export * from \"-!../../../node_modules/vue-style-loader/index.js!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\""],"sourceRoot":""}